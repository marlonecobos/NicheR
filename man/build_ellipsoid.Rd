% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/build_ellpisoid.R
\name{build_ellipsoid}
\alias{build_ellipsoid}
\title{Build a Probabilistic Ellipsoidal Niche}
\usage{
build_ellipsoid(
  range,
  cl = 0.95,
  level = 0.95,
  cor_tilt = NULL,
  n_points = 100
)
}
\arguments{
\item{range}{Input defining the niche centroid and marginal tolerances.
Supported formats include:
\itemize{
  \item data.frame with columns \code{min} and \code{max}
  \item list with \code{mu} and \code{sd}, or \code{mean} and \code{sd}
  \item list with \code{mu} and covariance matrix \code{Sigma}
  \item data.frame or matrix of observations (columns = dimensions)
}}

\item{cl}{Numeric between 0 and 1. Probability mass represented by
the supplied minimum and maximum values when \code{range} is defined by
bounds. Default is 0.95.}

\item{level}{Numeric between 0 and 1. Probability mass enclosed by the
ellipsoid contour. Default is 0.95.}

\item{cor_tilt}{Optional correlation structure controlling ellipsoid
orientation. Can be:
\itemize{
  \item \code{NULL} for no tilt (independent dimensions)
  \item a \eqn{p \times p} correlation matrix
  \item a matrix or data.frame of observations used to estimate correlation
}}

\item{n_points}{Integer. Number of surface points used to approximate the
ellipsoid boundary for visualization. Default is 100.}
}
\value{
An object of class \code{"nicheR_ellipsoid"} containing:
\itemize{
  \item \code{mu}: niche centroid
  \item \code{Sigma}: covariance matrix
  \item \code{Sigma_inv}: inverse covariance matrix
  \item \code{axes_sd}: marginal standard deviations
  \item \code{axes_boundary}: semi-axis lengths at the specified \code{level}
  \item \code{boundary_points}: surface coordinates for plotting
  \item \code{c2}: chi-square cutoff
}
}
\description{
Constructs a multivariate normal (MVN) ellipsoid in environmental space,
defined by a centroid, marginal tolerances, and optional correlation-based
tilt among dimensions. The ellipsoid represents a probability contour of
constant Mahalanobis distance.
}
\details{
The niche is defined as:
\deqn{X \sim \mathcal{N}(\mu, \Sigma)}

where the covariance matrix is decomposed as:
\deqn{\Sigma = D R D}

with \eqn{D} representing marginal standard deviations and \eqn{R} the
correlation (tilt) matrix.

Two probability levels are used:

\describe{
  \item{cl}{Probability mass represented by the user-supplied
  minimum and maximum values. Used only to infer marginal standard deviations
  when defining the multivariate normal niche.}

  \item{level}{Probability mass enclosed by the ellipsoid contour, defined by
  a chi-square quantile of the Mahalanobis distance.}
}


The ellipsoid boundary corresponds to:
\deqn{(x - \mu)^T \Sigma^{-1} (x - \mu) \le \chi^2_p(\text{level})}

This formulation allows separation of:
\itemize{
  \item marginal niche breadth (\code{range})
  \item correlation structure (\code{cor_tilt})
  \item probability contour (\code{level})
}
}
\seealso{
\code{\link{parse_range}}, \code{\link{parse_cor_tilt}}
}
